<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Mini Jumia</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .edit-btn, .delete-btn {
      font-size: 0.85rem;
      margin-right: 4px;
    }
  </style>
</head>
<body>
  <div id="userArea" class="text-end p-2"></div>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">üõç Mini Jumia</a>
      <a class="btn btn-success ms-auto" href="upload.html">‚ûï Upload Product</a>
    </div>
  </nav>  <div class="container mt-4">
    <h2>üìä Admin Dashboard</h2>
    <div class="row my-4">
      <div class="col-md-3">
        <div class="card text-bg-primary mb-3">
          <div class="card-body">
            <h5>Total Orders</h5>
            <p id="totalOrders">0</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-bg-warning mb-3">
          <div class="card-body">
            <h5>Pending</h5>
            <p id="pendingOrders">0</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-bg-success mb-3">
          <div class="card-body">
            <h5>Shipped</h5>
            <p id="shippedOrders">0</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-bg-info mb-3">
          <div class="card-body">
            <h5>Total Revenue (‚Ç¶)</h5>
            <p id="totalRevenue">0</p>
          </div>
        </div>
      </div>
    </div><h4>üì¶ Manage Orders</h4>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Customer</th>
        <th>Phone</th>
        <th>Address</th>
        <th>Items</th>
        <th>Status</th>
        <th>Change Status</th>
      </tr>
    </thead>
    <tbody id="ordersTable"></tbody>
  </table>
</div>

<h4 class="mt-5">üõí Product Management</h4>
<div class="table-responsive">
  <table class="table table-striped">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Price</th>
        <th>Category</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="productsTable"></tbody>
  </table>
</div>

  </div>  <script>
    const userArea = document.getElementById("userArea");
    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!user || user.role !== "admin") {
      alert("Access denied. Admins only.");
      window.location.href = "login.html";
    } else {
      userArea.innerHTML = `
        üëë Admin: <strong>${user.username}</strong>
        <button class="btn btn-sm btn-outline-danger ms-2" onclick="logout()">Logout</button>
      `;
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "login.html";
    }

    const orders = JSON.parse(localStorage.getItem("orderHistory")) || [];
    const ordersTable = document.getElementById("ordersTable");
    const totalOrders = document.getElementById("totalOrders");
    const pendingOrders = document.getElementById("pendingOrders");
    const shippedOrders = document.getElementById("shippedOrders");
    const totalRevenue = document.getElementById("totalRevenue");

    let pending = 0;
    let shipped = 0;
    let revenue = 0;

    orders.forEach((order, i) => {
      if (order.status === "Pending") pending++;
      if (order.status === "Shipped") shipped++;

      const orderTotal = order.items.reduce((sum, item) => sum + item.price, 0);
      revenue += orderTotal;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${i + 1}</td>
        <td>${order.name}</td>
        <td>${order.phone}</td>
        <td>${order.address}</td>
        <td><ul>${order.items.map(p => `<li>${p.name} - ‚Ç¶${p.price.toLocaleString()}</li>`).join("")}</ul></td>
        <td>${order.status || "Pending"}</td>
        <td>
          <select class="form-select" onchange="updateStatus(${i}, this.value)">
            <option value="Pending" ${order.status === "Pending" ? "selected" : ""}>Pending</option>
            <option value="Shipped" ${order.status === "Shipped" ? "selected" : ""}>Shipped</option>
            <option value="Delivered" ${order.status === "Delivered" ? "selected" : ""}>Delivered</option>
          </select>
        </td>
      `;
      ordersTable.appendChild(row);
    });

    totalOrders.textContent = orders.length;
    pendingOrders.textContent = pending;
    shippedOrders.textContent = shipped;
    totalRevenue.textContent = "‚Ç¶" + revenue.toLocaleString();

    function updateStatus(index, newStatus) {
      orders[index].status = newStatus;
      localStorage.setItem("orderHistory", JSON.stringify(orders));
      alert("Status updated");
      location.reload();
    }

    const products = JSON.parse(localStorage.getItem("products")) || [];
    const productsTable = document.getElementById("productsTable");

    products.forEach((p, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${i + 1}</td>
        <td>${p.name}</td>
        <td>‚Ç¶${p.price.toLocaleString()}</td>
        <td>${p.category}</td>
        <td>
          <button class="btn btn-sm btn-warning edit-btn" onclick="editProduct(${i})">‚úèÔ∏è Edit</button>
          <button class="btn btn-sm btn-danger delete-btn" onclick="deleteProduct(${i})">üóëÔ∏è Delete</button>
        </td>
      `;
      productsTable.appendChild(row);
    });

    function editProduct(index) {
      const prod = products[index];
      const newName = prompt("Edit product name:", prod.name);
      const newPrice = prompt("Edit price:", prod.price);
      const newCategory = prompt("Edit category:", prod.category);
      if (newName && newPrice && newCategory) {
        products[index] = { ...prod, name: newName, price: parseFloat(newPrice), category: newCategory };
        localStorage.setItem("products", JSON.stringify(products));
        alert("Product updated");
        location.reload();
      }
    }

    function deleteProduct(index) {
      if (confirm("Delete this product?")) {
        products.splice(index, 1);
        localStorage.setItem("products", JSON.stringify(products));
        alert("Product deleted");
        location.reload();
      }
    }
  </script>
</body>
</html>
