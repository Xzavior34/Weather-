<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Products - Mini Jumia</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container mt-4">
    <h2>üõ† Edit & Delete Products</h2>
    <div id="productList" class="row g-4 mt-3"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCOgQW8DzFIU9sJXD0j09kFpEzOpocfrpM",
      authDomain: "mini-jumia-42773.firebaseapp.com",
      databaseURL: "https://mini-jumia-42773-default-rtdb.firebaseio.com",
      projectId: "mini-jumia-42773",
      storageBucket: "mini-jumia-42773.appspot.com",
      messagingSenderId: "641009946484",
      appId: "1:641009946484:web:23a692390add3827802621"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const productList = document.getElementById("productList");

    onValue(ref(db, "products"), (snapshot) => {
      productList.innerHTML = "";
      const data = snapshot.val();
      if (!data) {
        productList.innerHTML = "<p>No products found.</p>";
        return;
      }

      for (const id in data) {
        const product = data[id];

        const col = document.createElement("div");
        col.className = "col-md-4";
        col.innerHTML = `
          <div class="card h-100">
            <img src="${product.image}" class="card-img-top" alt="${product.name}" style="max-height: 200px; object-fit: contain;">
            <div class="card-body">
              <h5 class="card-title">${product.name}</h5>
              <p class="card-text">‚Ç¶${product.price.toLocaleString()}</p>
              <p class="card-text"><strong>Category:</strong> ${product.category}</p>
              <p class="card-text">${product.description}</p>
              <button class="btn btn-sm btn-warning me-2" onclick="editProduct('${id}', '${product.name}', ${product.price}, '${product.image}', '${product.category}', \`${product.description}\`)">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteProduct('${id}')">Delete</button>
            </div>
          </div>
        `;
        productList.appendChild(col);
      }
    });

    window.editProduct = (id, name, price, image, category, description) => {
      const newName = prompt("Edit Product Name:", name);
      const newPrice = prompt("Edit Price:", price);
      const newImage = prompt("Edit Image URL:", image);
      const newCategory = prompt("Edit Category:", category);
      const newDesc = prompt("Edit Description:", description);

      if (newName && newPrice && newImage && newCategory && newDesc) {
        update(ref(db, `products/${id}`), {
          name: newName,
          price: parseFloat(newPrice),
          image: newImage,
          category: newCategory,
          description: newDesc
        }).then(() => alert("‚úÖ Product updated!"))
          .catch(err => alert("‚ùå Failed to update product."));
      }
    };

    window.deleteProduct = (id) => {
      if (confirm("Are you sure you want to delete this product?")) {
        remove(ref(db, `products/${id}`))
          .then(() => alert("üóë Product deleted"))
          .catch(err => alert("‚ùå Failed to delete product"));
      }
    };
  </script>
</body>
</html>
